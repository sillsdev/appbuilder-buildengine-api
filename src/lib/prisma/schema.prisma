generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model build {
  id                Int       @id @default(autoincrement())
  job_id            Int
  status            String?   @db.VarChar(255)
  result            String?   @db.VarChar(255)
  error             String?   @db.VarChar(2083)
  created           DateTime? @default(now()) @db.Timestamp(6)
  updated           DateTime? @updatedAt @db.Timestamp(6)
  channel           String?   @db.VarChar(255)
  version_code      Int?
  artifact_url_base String?   @db.VarChar(2083)
  artifact_files    String?   @db.VarChar(4096)
  build_guid        String?   @db.VarChar(255)
  console_text_url  String?   @db.VarChar(255)
  codebuild_url     String?   @db.VarChar(255)
  targets           String?   @db.VarChar(255)
  environment       String?
  job               job       @relation(fields: [job_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_build_job_id")
  release           release[]

  @@index([job_id], map: "idx_build_job_id")
}

model client {
  id           Int       @id @default(autoincrement())
  access_token String    @db.VarChar(255)
  prefix       String    @db.VarChar(4)
  created      DateTime? @default(now()) @db.Timestamp(6)
  updated      DateTime? @updatedAt @db.Timestamp(6)
  job          job[]
  project      project[]

  @@index([access_token], map: "idx_accesS_token")
}

model job {
  id                    Int       @id @default(autoincrement())
  request_id            String    @db.VarChar(255)
  git_url               String    @db.VarChar(2083)
  app_id                String    @db.VarChar(255)
  publisher_id          String    @db.VarChar(255)
  created               DateTime? @default(now()) @db.Timestamp(6)
  updated               DateTime? @updatedAt @db.Timestamp(6)
  client_id             Int?
  existing_version_code Int?      @default(0)
  jenkins_build_url     String?   @db.VarChar(1024)
  jenkins_publish_url   String?   @db.VarChar(1024)
  build                 build[]
  client                client?   @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_job_client_id")

  @@index([client_id], map: "idx_job_client_id")
  @@index([request_id], map: "idx_request_id")
}

model project {
  id             Int       @id @default(autoincrement())
  status         String?   @db.VarChar(255)
  result         String?   @db.VarChar(255)
  error          String?   @db.VarChar(2083)
  url            String?   @db.VarChar(1024)
  user_id        String?   @db.VarChar(255)
  group_id       String?   @db.VarChar(255)
  app_id         String?   @db.VarChar(255)
  project_name   String?   @db.VarChar(255)
  language_code  String?   @db.VarChar(255)
  publishing_key String?   @db.VarChar(1024)
  created        DateTime? @default(now()) @db.Timestamp(6)
  updated        DateTime? @updatedAt @db.Timestamp(6)
  client_id      Int?
  client         client?   @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_project_client_id")

  @@index([client_id], map: "idx_project_client_id")
}

model release {
  id                Int       @id @default(autoincrement())
  build_id          Int
  status            String?   @db.VarChar(255)
  created           DateTime? @default(now()) @db.Timestamp(6)
  updated           DateTime? @updatedAt @db.Timestamp(6)
  result            String?   @db.VarChar(255)
  error             String?   @db.VarChar(2083)
  channel           String    @db.VarChar(255)
  title             String?   @db.VarChar(30)
  defaultLanguage   String?   @db.VarChar(255)
  promote_from      String?   @db.VarChar(255)
  build_guid        String?   @db.VarChar(255)
  console_text_url  String?   @db.VarChar(255)
  codebuild_url     String?   @db.VarChar(255)
  targets           String?   @db.VarChar(255)
  environment       String?
  artifact_url_base String?   @db.VarChar(255)
  artifact_files    String?   @db.VarChar(255)
  build             build     @relation(fields: [build_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_release_build_id")

  @@index([build_id], map: "idx_release_build_id")
}

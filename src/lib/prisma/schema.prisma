generator client {
  provider        = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model build {
  id                Int       @id @default(autoincrement())
  job_id            Int
  status            String?   @db.VarChar(255)
  result            String?   @db.VarChar(255)
  error             String?   @db.VarChar(2083)
  created           DateTime? @db.DateTime(0)
  updated           DateTime? @db.DateTime(0)
  channel           String?   @db.VarChar(255)
  version_code      Int?
  artifact_url_base String?   @db.VarChar(2083)
  artifact_files    String?   @db.VarChar(4096)
  build_guid        String?   @db.VarChar(255)
  console_text_url  String?   @db.VarChar(255)
  codebuild_url     String?   @db.VarChar(255)
  targets           String?   @db.VarChar(255)
  environment       String?   @db.Text
  job               job       @relation(fields: [job_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_build_job_id")
  release           release[]

  @@index([job_id], map: "fk_build_job_id")
}

model client {
  id           Int       @id @default(autoincrement())
  access_token String    @db.VarChar(255)
  prefix       String    @db.VarChar(4)
  created      DateTime? @db.DateTime(0)
  updated      DateTime? @db.DateTime(0)
  job          job[]
  project      project[]

  @@index([access_token], map: "idx_accesS_token")
}

model email_queue {
  id             Int       @id @default(autoincrement())
  to             String    @db.VarChar(255)
  cc             String?   @db.VarChar(255)
  bcc            String?   @db.VarChar(255)
  subject        String    @db.VarChar(255)
  text_body      String?   @db.Text
  html_body      String?   @db.Text
  attempts_count Boolean?
  last_attempt   DateTime? @db.DateTime(0)
  created        DateTime? @db.DateTime(0)
  error          String?   @db.VarChar(255)
}

model job {
  id                    Int       @id @default(autoincrement())
  request_id            String    @db.VarChar(255)
  git_url               String    @db.VarChar(2083)
  app_id                String    @db.VarChar(255)
  publisher_id          String    @db.VarChar(255)
  created               DateTime? @db.DateTime(0)
  updated               DateTime? @db.DateTime(0)
  client_id             Int?
  existing_version_code Int?      @default(0)
  jenkins_build_url     String?   @db.VarChar(1024)
  jenkins_publish_url   String?   @db.VarChar(1024)
  build                 build[]
  client                client?   @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_job_client_id")

  @@index([client_id], map: "fk_job_client_id")
  @@index([request_id], map: "idx_request_id")
}

model migration {
  version    String @id @db.VarChar(180)
  apply_time Int?
}

model operation_queue {
  id                  Int       @id @default(autoincrement())
  operation           String    @db.VarChar(255)
  operation_object_id Int?
  operation_parms     String?   @db.VarChar(2048)
  attempt_count       Int
  last_attempt        DateTime? @db.DateTime(0)
  try_after           DateTime? @db.DateTime(0)
  start_time          DateTime? @db.DateTime(0)
  last_error          String?   @db.VarChar(2048)
  created             DateTime? @db.DateTime(0)
  updated             DateTime? @db.DateTime(0)

  @@index([start_time], map: "idx_start_time")
  @@index([try_after], map: "idx_try_after")
}

model project {
  id             Int       @id @default(autoincrement())
  status         String?   @db.VarChar(255)
  result         String?   @db.VarChar(255)
  error          String?   @db.VarChar(2083)
  url            String?   @db.VarChar(1024)
  user_id        String?   @db.VarChar(255)
  group_id       String?   @db.VarChar(255)
  app_id         String?   @db.VarChar(255)
  project_name   String?   @db.VarChar(255)
  language_code  String?   @db.VarChar(255)
  publishing_key String?   @db.VarChar(1024)
  created        DateTime? @db.DateTime(0)
  updated        DateTime? @db.DateTime(0)
  client_id      Int?
  client         client?   @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_project_client_id")

  @@index([client_id], map: "fk_project_client_id")
}

model release {
  id                Int       @id @default(autoincrement())
  build_id          Int
  status            String?   @db.VarChar(255)
  created           DateTime? @db.DateTime(0)
  updated           DateTime? @db.DateTime(0)
  result            String?   @db.VarChar(255)
  error             String?   @db.VarChar(2083)
  channel           String    @db.VarChar(255)
  title             String?   @db.VarChar(30)
  defaultLanguage   String?   @db.VarChar(255)
  promote_from      String?   @db.VarChar(255)
  build_guid        String?   @db.VarChar(255)
  console_text_url  String?   @db.VarChar(255)
  codebuild_url     String?   @db.VarChar(255)
  targets           String?   @db.VarChar(255)
  environment       String?   @db.Text
  artifact_url_base String?   @db.VarChar(255)
  artifact_files    String?   @db.VarChar(255)
  build             build     @relation(fields: [build_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_release_build_id")

  @@index([build_id], map: "fk_release_build_id")
}
